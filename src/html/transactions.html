<div x-data="transactionsComponent" class="py-4 px-0 md:px-2">
    <h2 id="app-title" class="text-2xl font-bold mb-8">Manajement Transaksi</h2>

    <button id="button-add" @click="location.href = '?c=transaction-add'" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Tambah Transaksi</button>

    <form id="formSearch" @submit.prevent="get(1)" class="flex items-center justify-between flex-column md:flex-row flex-wrap space-y-4 md:space-y-0 py-4 bg-white dark:bg-gray-900 relative gap-3">
        <div class="sr-only">DOR</div>

        <div id="date-range-picker" class="flex items-center w-[19rem] gap-3">
            <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"></div>

                <input
                    id="datepicker-range-start"
                    datepicker-title="Tanggal Awal"
                    type="search"
                    readonly
                    x-model="formSearch.date_start"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 placeholder-shown:text-xs text-center"
                    placeholder="Tanggal Awal" />

                <div class="absolute inset-1 pointer-events-none bg-gray-50 grid place-content-center">
                    <span class="text-xs" x-text="formSearch.date_start || 'Tanggal Awal'"></span>
                </div>

                <div x-show="false" class="absolute top-0 bottom-0 right-1 flex items-center pl-4">
                    <button type="button" x-show="formSearch.date_start" @click="formSearch.date_start = null" class="font-bold text-gray-6border-gray-600 rounded-md px-2 scale-75">&cross;</button>
                </div>
            </div>

            <span class="text-gray-500">sampai</span>

            <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"></div>
                <input
                    id="datepicker-range-end"
                    datepicker-title="Tanggal Akhir"
                    type="search"
                    readonly
                    x-model="formSearch.date_end"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-xs rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 placeholder-shown:text-xs text-center"
                    placeholder="Tanggal Akhir" />

                <div class="absolute inset-1 pointer-events-none bg-gray-50 grid place-content-center">
                    <span class="text-xs" x-text="formSearch.date_end || 'Tanggal Akhir'"></span>
                </div>

                <div x-show="false" class="absolute top-0 bottom-0 right-1 flex items-center pl-4">
                    <button type="button" x-show="formSearch.date_end" @click="formSearch.date_end = null" class="font-bold text-gray-6border-gray-600 rounded-md px-2 scale-75">&cross;</button>
                </div>
            </div>
        </div>

        <div class="inline-flex gap-4 items-center justify-self-end">
            <div class="relative conn-dropdown" x-data="dropdown">
                <button
                    @click="toggleDropdown"
                    class="inline-flex items-center text-gray-500 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-lg text-sm px-4 py-2 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700"
                    type="button">
                    <span class="sr-only pr-3">Filter button</span>
                    <span class="pr-1">Filter</span>
                    <svg class="ml-4 w-2.5 h-2.5 ms-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" />
                    </svg>
                </button>

                <div
                    x-show="isDropdownOpen"
                    x-cloak=""
                    @click.outside="disableDropdown"
                    class="dropdown-menu top-full absolute z-50 bg-white divide-y divide-gray-100 rounded-lg shadow-md dark:bg-gray-700 dark:divide-gray-600">
                    <ul class="grid grid-cols-[repeat(2,minmax(8rem,1fr))] py-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownActionButton">
                        <template x-for="(payment_method, index, all) in Object.keys(paymentMethods)" :key="payment_method">
                            <label
                                x-show="all.length > 1"
                                :for="`payment_method-${ payment_method }`"
                                class="flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
                                <input type="checkbox" :id="`payment_method-${ payment_method }`" x-model="formSearch.payment_methods" :value="payment_method" />
                                <span x-text="payment_method"></span>
                            </label>
                        </template>

                        <template x-for="(payment_status, index, all) in Object.keys(paymentMethods).map(prop => paymentMethods[prop]).flat()" :key="payment_status">
                            <label
                                x-show="all.length > 1"
                                :for="`payment_status-${ payment_status }`"
                                class="flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
                                <input type="checkbox" :id="`payment_status-${ payment_status }`" x-model="formSearch.payment_statuses" :value="payment_status" />
                                <span x-text="payment_status"></span>
                            </label>
                        </template>

                        <li>
                            <label for="s_sort_desc" class="flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
                                <input type="checkbox" id="s_sort_desc" x-model="formSearch.sort_desc" />
                                <span>Sortir Terbalik</span>
                            </label>
                        </li>
                    </ul>
                    <!-- <div class="py-1">
                    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Delete User</a>
                </div> -->
                </div>
            </div>
            <!-- <div class="relative">
                <label for="table-search" class="sr-only">Search</label>
                <div class="absolute inset-y-0 rtl:inset-r-0 start-0 flex items-center ps-3 pointer-events-none">
                    <svg class="ml-2 w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                    </svg>
                </div>
                <input
                    type="search"
                    id="table-search-users"
                    @focus="console.log"
                    @change="console.log"
                    name="keyword"
                    x-model="formSearch.keyword"
                    @keyup.enter="get(1)"
                    class="block pt-2 py-2 pl-8 text-sm text-gray-900 border border-gray-300 rounded-lg w-44 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                    placeholder="Cari Transaksi..."
                    autocomplete="off" />
            </div> -->
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded text-sm">Cari</button>
        </div>

        <div class="sr-only">Dor</div>
    </form>

    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
        <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                    <th scope="col" class="px-4 py-3">No</th>
                    <th scope="col" class="px-6 py-3">Tanggal</th>
                    <th scope="col" class="px-6 py-3">Total</th>
                    <th scope="col" class="px-6 py-3">Pembayaran</th>
                    <th scope="col" class="px-6 py-3">Aksi</th>
                    <th scope="col" class="px-6 py-3">Aksi Tambahan</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(transaction, index) in transactions" :key="transaction.id">
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <td class="px-4 py-4 text-xs" x-text="index + page.start_index"></td>
                        <td class="px-6 py-4 text-xs" x-text="transaction.date"></td>
                        <td class="px-6 py-4" x-text="IDR.format(transaction.total)"></td>
                        <td class="px-6 py-4 text-xs">
                            <span x-text="transaction.payment_method"></span>
                            >
                            <span x-text="transaction.payment_status"></span>
                        </td>
                        <!-- <td class="px-6 py-4" x-text="transaction.payment_status"></td> -->
                        <td class="px-6 py-4 text-xs">
                            <!-- Modal toggle -->
                            <button type="button" @click="openModalDetail(transaction)" class="btn-detail font-medium hover:underline">Detail</button>
                            <button type="button" @click="selectEdit(transaction)" class="btn-edit font-medium hover:underline">Ubah</button>
                            <button type="button" @click="remove(transaction)" class="btn-remove font-medium hover:underline">Hapus</button>
                        </td>
                        <td class="px-6 py-4 text-xs">
                            <button type="button" @click="openStruct(transaction)" class="btn-struct font-medium hover:underline">Struk</button>
                            <button
                                x-show="transaction.payment_method == 'Tunai' && transaction.payment_status == 'Belum dibayar'"
                                type="button"
                                @click="bayar(transaction)"
                                class="btn-pay font-medium hover:underline">
                                Bayar
                            </button>
                            <button
                                x-show="transaction.payment_method == 'Transfer' && transaction.payment_status == 'Pending'"
                                type="button"
                                @click="window.open(`pay.html?token=${ transaction.payment_token }`, '_blank')"
                                class="btn-pay font-medium hover:underline">
                                Bayar
                            </button>
                            <button
                                x-show="transaction.payment_method == 'Transfer' && transaction.payment_status == 'Pending'"
                                type="button"
                                @click="syncTransactionStatus(transaction)"
                                class="btn-sync font-medium hover:underline">
                                Sync
                            </button>
                            <button
                                x-show="transaction.payment_method == 'Transfer' && transaction.payment_status == 'Expire'"
                                type="button"
                                @click="remakeTransaction(transaction)"
                                class="btn-add font-medium hover:underline">
                                Remake Token
                            </button>
                        </td>
                    </tr>
                </template>
                <tr x-show="!transactions.length">
                    <th scope="col" colspan="6" class="px-4 py-4 text-xl font-bold text-center">Tidak ada data!</th>
                </tr>
            </tbody>
        </table>
    </div>

    <nav x-show="transactions.length" class="flex flex-wrap justify-between items-center gap-3 gap-x-5 pt-4" aria-label="Table navigation">
        <!-- Showing Info -->
        <div class="text-sm text-gray-600 dark:text-gray-300 text-center md:text-left mx-auto">
            Menampilkan
            <span class="font-semibold text-gray-900 dark:text-white">
                <span x-text="page.start_index"></span>
                -
                <span x-text="page.end_index"></span>
            </span>
            dari
            <span class="font-semibold text-gray-900 dark:text-white" x-text="page.total_data"></span>
            data.
        </div>

        <!-- Pagination Group -->
        <ul class="mx-auto self-center inline-flex -space-x-px rtl:space-x-reverse text-xs h-8 rounded-m md:text-sm" x-show="transactions.length">
            <li>
                <a
                    href="#formSearch"
                    @click="page.page != 1 && get(1)"
                    :class="page.page === 1 ? 'pointer-events-none opacity-50' : ''"
                    class="flex items-center justify-center px-3 md:px-3 h-8 md:h-8 ms-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    &laquo;
                </a>
            </li>
            <li>
                <a
                    href="#formSearch"
                    @click="page.page != 1 && get(page.page - 1)"
                    :class="page.page === 1 ? 'pointer-events-none opacity-50' : ''"
                    class="flex items-center justify-center px-3 md:px-3 h-8 md:h-8 ms-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    &lsaquo;
                </a>
            </li>

            <template x-for="(num,index) in page.buttons" :key="num">
                <li>
                    <a
                        href="#formSearch"
                        @click="page.page != num && get(num)"
                        x-text="num"
                        :class="page.page != num ? ' text-gray-500 bg-white dark:bg-gray-800 dark:text-gray-400 ' : 'bg-gray-100 text-gray-700  dark:bg-gray-700 dark:text-white'"
                        class="flex items-center justify-center px-3 md:px-3 h-8 md:h-8 leading-tight border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:hover:bg-gray-700 dark:hover:text-white"></a>
                </li>
            </template>

            <li>
                <a
                    href="#formSearch"
                    @click="page.page != page.total_page && get(page.page+1)"
                    :class="page.page === page.total_page ? 'pointer-events-none opacity-50' : ''"
                    class="flex items-center justify-center px-3 md:px-3 h-8 md:h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    &rsaquo;
                </a>
            </li>
            <li>
                <a
                    href="#formSearch"
                    @click="page.page != page.total_page && get(page.total_page)"
                    :class="page.page === page.total_page ? 'pointer-events-none opacity-50' : ''"
                    class="flex items-center justify-center px-3 md:px-3 h-8 md:h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                    &raquo;
                </a>
            </li>
        </ul>
    </nav>

    <!-- Edit user modal -->
    <div id="mainModal" x-show="isOpenModal" x-cloak="" class="bg-[rgba(0,0,0,.5)] modal-conn">
        <div class="relative w-full max-w-2xl max-h-full" @click.outside="isOpenModal = false">
            <!-- Modal content -->
            <form id="main-form" class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700" @submit.prevent="edit">
                <!-- Modal header -->
                <div class="flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600 border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                        <span>Ubah</span>
                        Produk
                    </h3>
                    <button
                        @click="isOpenModal = false"
                        type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Tutup modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <div class="p-6 space-y-6">
                    <div class="grid grid-cols-6 gap-6">
                        <div class="col-span-6 sm:col-span-3">
                            <label for="total" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Total</label>
                            <input
                                type="text"
                                name="total"
                                id="total"
                                x-model="form.total"
                                class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                required=""
                                readonly />
                        </div>
                        <div class="col-span-6 sm:col-span-3">
                            <label for="date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tanggal</label>
                            <input
                                type="text"
                                name="date"
                                id="date"
                                x-model="form.date"
                                class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                required=""
                                readonly />
                        </div>

                        <div class="col-span-6 sm:col-span-3">
                            <label for="payment_method" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Metode Transaksi</label>
                            <select
                                id="payment_method"
                                name="payment_method"
                                x-model="form.payment_method"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                <template x-for="status in PAYMENT_METHODS" :key="status">
                                    <option :value="status" x-text="status"></option>
                                </template>
                            </select>
                        </div>
                        <div class="col-span-6 sm:col-span-3">
                            <label for="payment_status" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Status Transaksi</label>

                            <template x-if="form.payment_method == PAYMENT_METHODS[0]">
                                <select
                                    id="payment_status"
                                    name="payment_status"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                    <template x-for="(status, index) in [...new Set([form.payment_status, ...PAYMENT_STATUS_CASH])]" :key="(status || '') + ' '  + index">
                                        <option :value="status" x-text="status"></option>
                                    </template>
                                </select>
                            </template>
                            <template x-if="form.payment_method != PAYMENT_METHODS[0]">
                                <input
                                    type="text"
                                    name="payment_status"
                                    id="payment_status"
                                    x-model="form.payment_status"
                                    class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                    required=""
                                    readonly />
                            </template>
                        </div>
                    </div>
                </div>
                <!-- Modal footer -->
                <div class="flex items-center p-6 space-x-3 rtl:space-x-reverse border-t border-gray-200 rounded-b dark:border-gray-600">
                    <button
                        type="submit"
                        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                        Ubah
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="isOpenDetailModal" x-cloak="" class="bg-[rgba(0,0,0,.5)] modal-conn">
        <div class="relative max-w-2xl max-h-full flex items-center justify-center w-max" @click.outside="isOpenDetailModal = false">
            <div class="relative bg-white rounded-lg shadow-sm dark:bg-gray-700">
                <!-- Modal header -->
                <div class="flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600 border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                        <span>Detail</span>
                        Transaksi
                    </h3>
                    <button
                        @click="isOpenDetailModal = false"
                        type="button"
                        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                        <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                        </svg>
                        <span class="sr-only">Tutup modal</span>
                    </button>
                </div>
                <!-- Modal body -->
                <div class="p-6 space-y-4 max-h-[75vh] overflow-y-auto">
                    <!-- Ringkasan -->
                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-700 dark:text-white">
                        <div>
                            <strong>Tanggal:</strong>
                            <span x-text="detail.date"></span>
                        </div>
                        <div>
                            <strong>Total:</strong>
                            <span x-text="IDR.format(detail.total)"></span>
                        </div>
                        <div>
                            <strong>Status:</strong>
                            <span x-text="detail.payment_status"></span>
                        </div>
                        <div>
                            <strong>Metode:</strong>
                            <span x-text="detail.payment_method"></span>
                        </div>
                        <template x-if="detail.payment_key">
                            <div>
                                <strong>Kunci Transaksi:</strong>
                                <span x-text="detail.payment_key"></span>
                            </div>
                        </template>
                        <template x-if="detail.payment_token">
                            <div class="col-span-2">
                                <strong>Link Pembayaran:</strong>
                                <a class="text-blue-600 underline" target="_blank" :href="`./pay.html?token=${detail.payment_token}`" x-text="detail.payment_token"></a>
                            </div>
                        </template>
                    </div>

                    <!-- Daftar Item Transaksi -->
                    <div>
                        <h4 class="font-semibold text-lg mb-2">List Produk</h4>
                        <template x-if="false">
                            <div class="overflow-x-auto">
                                <table class="min-w-full text-sm text-left text-gray-700 border">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="px-2 py-1 border">#</th>
                                            <th class="px-2 py-1 border">Produk</th>
                                            <th class="px-2 py-1 border">Harga</th>
                                            <th class="px-2 py-1 border">Qty</th>
                                            <th class="px-2 py-1 border">Subtotal</th>
                                            <th class="px-2 py-1 border">Laba</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, index) in detail.transaction_details" :key="index">
                                            <tr class="border-t">
                                                <td class="px-2 py-1" x-text="index + 1"></td>
                                                <td class="px-2 py-1" x-text="item.name"></td>
                                                <td class="px-2 py-1" x-text="IDR.format(item.price)"></td>
                                                <td class="px-2 py-1" x-text="item.quantity"></td>
                                                <td class="px-2 py-1" x-text="IDR.format(item.sub_total)"></td>
                                                <td class="px-2 py-1" x-text="IDR.format(item.profit)"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </template>
                        <!-- Product Details Table -->
                        <div class="overflow-x-auto mt-6">
                            <table class="min-w-full divide-y divide-gray-200 text-sm">
                                <thead class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                                    <tr>
                                        <th class="px-4 py-2 text-left">Produk</th>
                                        <th class="px-4 py-2 text-right">Harga</th>
                                        <th class="px-4 py-2 text-right">Qty</th>
                                        <th class="px-4 py-2 text-right">Subtotal</th>
                                        <th class="px-4 py-2 text-right">Profit</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <template x-for="item in detail.transaction_details" :key="item.name">
                                        <tr
                                            :class="{
                                  'text-gray-800': !item.product?.deprecated_code,
                                  'bg-yellow-50 text-yellow-900': item.product?.deprecated_code == 1,
                                  'bg-red-50 text-red-800 italic': item.product?.deprecated_code == 2
                                }">
                                            <td class="px-4 py-3">
                                                <div class="flex items-center gap-3">
                                                    <img :src="`./src/img/db/${item.product.image}`" class="w-10 h-10 rounded object-cover border" alt="" />
                                                    <div>
                                                        <div class="font-medium">
                                                            <a
                                                                x-show="item.deprecated_code != 2"
                                                                x-text="item.name"
                                                                :href="`?c=products&filters=name&keyword=${ item.name }`"
                                                                class="hover:text-blue-600 hover:underline"></a>
                                                            <span x-show="item.deprecated_code == 2" x-text="item.name"></span>
                                                        </div>
                                                        <div class="text-xs text-gray-500" x-text="`${item.product.category} â€º ${item.product.subcategory}`"></div>
                                                        <template x-if="item.product.deprecated_code == 1">
                                                            <span class="text-xs text-yellow-700 bg-yellow-100 rounded px-2 py-0.5 mt-1 inline-block">Harga Berubah</span>
                                                        </template>
                                                        <template x-if="item.product.deprecated_code == 2">
                                                            <span class="text-xs text-red-700 bg-red-100 rounded px-2 py-0.5 mt-1 inline-block">Telah Dihapus</span>
                                                        </template>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-4 py-3 text-right" x-text="IDR.format(item.price)"></td>
                                            <td class="px-4 py-3 text-right" x-text="item.quantity"></td>
                                            <td class="px-4 py-3 text-right" x-text="IDR.format(item.sub_total)"></td>
                                            <td class="px-4 py-3 text-right text-green-600" x-text="IDR.format(item.profit)"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>

                        <p class="text-right mt-2 text-sm text-gray-600">
                            Total Laba:
                            <span class="font-semibold" x-text="IDR.format(detail.profit)"></span>
                        </p>
                    </div>
                </div>

                <!-- Modal footer -->
                <!-- <div class="flex items-center p-6 space-x-3 rtl:space-x-reverse border-t border-gray-200 rounded-b dark:border-gray-600">
                    <button type="" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Ubah</button>
                </div> -->
            </div>
        </div>
    </div>

    <!-- Struk Modal -->
    <div id="print-modal" x-show="isOpenStructModal" x-cloak="" :class="whilePrint ? 'bg-white py-8' : 'bg-[rgba(0,0,0,.5)]'" class="modal-conn cursor-pointer pt-20">
        <div
            @click.outside="isOpenStructModal = false"
            id="print-modal-2"
            :class="whilePrint ? 'bg-white' : 'bg-white'"
            class="overflow-y-auto relative max-w-2xl flex items-center justify-center w-max cursor-default rounded p-6">
            <div id="print-modal-3" class="overflow-y-auto flex flex-col gap-2">
                <div id="svg-shop flex justify-center">
                    <!-- <svg viewBox="0 0 24 24" fill="none" class="shrink-0 w-12 h-12 mx-auto" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.5276 2H7.47201C6.26919 2 5.66778 2 5.18448 2.2987C4.70117 2.5974 4.43221 3.13531 3.8943 4.21114L2.49068 7.75929C2.16639 8.57905 1.88266 9.54525 2.42854 10.2375C2.79476 10.7019 3.36244 11 3.99978 11C5.10435 11 5.99978 10.1046 5.99978 9C5.99978 10.1046 6.89522 11 7.99978 11C9.10435 11 9.99978 10.1046 9.99978 9C9.99978 10.1046 10.8952 11 11.9998 11C13.1044 11 13.9998 10.1046 13.9998 9C13.9998 10.1046 14.8952 11 15.9998 11C17.1044 11 17.9998 10.1046 17.9998 9C17.9998 10.1046 18.8952 11 19.9998 11C20.6371 11 21.2048 10.7019 21.5711 10.2375C22.117 9.54525 21.8333 8.57905 21.509 7.75929L20.1054 4.21114C19.5674 3.13531 19.2985 2.5974 18.8152 2.2987C18.3319 2 17.7305 2 16.5276 2Z" fill="#1C274C"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M20 21.25H22C22.4142 21.25 22.75 21.5858 22.75 22C22.75 22.4142 22.4142 22.75 22 22.75H2C1.58579 22.75 1.25 22.4142 1.25 22C1.25 21.5858 1.58579 21.25 2 21.25H4L4 12.5C4.74363 12.5 5.43309 12.2681 6 11.8727C6.56692 12.2681 7.25638 12.5 8 12.5C8.74363 12.5 9.43309 12.2681 10 11.8727C10.5669 12.2681 11.2564 12.5 12 12.5C12.7436 12.5 13.4331 12.2681 14 11.8727C14.5669 12.2681 15.2564 12.5 16 12.5C16.7436 12.5 17.4331 12.2681 18 11.8727C18.5669 12.2681 19.2564 12.5 20 12.5L20 21.25ZM9.5 21.25H14.5V18.5C14.5 17.5654 14.5 17.0981 14.299 16.75C14.1674 16.522 13.978 16.3326 13.75 16.2009C13.4019 16 12.9346 16 12 16C11.0654 16 10.5981 16 10.25 16.2009C10.022 16.3326 9.83261 16.522 9.70096 16.75C9.5 17.0981 9.5 17.5654 9.5 18.5V21.25Z" fill="000000"></path> </g></svg> -->

                    <svg viewBox="0 0 24 24" fill="none" class="shrink-0 w-12 h-12 mx-auto" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path
                                d="M16.5276 2H7.47201C6.26919 2 5.66778 2 5.18448 2.2987C4.70117 2.5974 4.43221 3.13531 3.8943 4.21114L2.49068 7.75929C2.16639 8.57905 1.88266 9.54525 2.42854 10.2375C2.79476 10.7019 3.36244 11 3.99978 11C5.10435 11 5.99978 10.1046 5.99978 9C5.99978 10.1046 6.89522 11 7.99978 11C9.10435 11 9.99978 10.1046 9.99978 9C9.99978 10.1046 10.8952 11 11.9998 11C13.1044 11 13.9998 10.1046 13.9998 9C13.9998 10.1046 14.8952 11 15.9998 11C17.1044 11 17.9998 10.1046 17.9998 9C17.9998 10.1046 18.8952 11 19.9998 11C20.6371 11 21.2048 10.7019 21.5711 10.2375C22.117 9.54525 21.8333 8.57905 21.509 7.75929L20.1054 4.21114C19.5674 3.13531 19.2985 2.5974 18.8152 2.2987C18.3319 2 17.7305 2 16.5276 2Z"
                                fill="#1C274C"></path>
                            <path
                                fill-rule="evenodd"
                                clip-rule="evenodd"
                                d="M20 21.25H22C22.4142 21.25 22.75 21.5858 22.75 22C22.75 22.4142 22.4142 22.75 22 22.75H2C1.58579 22.75 1.25 22.4142 1.25 22C1.25 21.5858 1.58579 21.25 2 21.25H4L4 12.5C4.74363 12.5 5.43309 12.2681 6 11.8727C6.56692 12.2681 7.25638 12.5 8 12.5C8.74363 12.5 9.43309 12.2681 10 11.8727C10.5669 12.2681 11.2564 12.5 12 12.5C12.7436 12.5 13.4331 12.2681 14 11.8727C14.5669 12.2681 15.2564 12.5 16 12.5C16.7436 12.5 17.4331 12.2681 18 11.8727C18.5669 12.2681 19.2564 12.5 20 12.5L20 21.25ZM9.5 21.25H14.5V18.5C14.5 17.5654 14.5 17.0981 14.299 16.75C14.1674 16.522 13.978 16.3326 13.75 16.2009C13.4019 16 12.9346 16 12 16C11.0654 16 10.5981 16 10.25 16.2009C10.022 16.3326 9.83261 16.522 9.70096 16.75C9.5 17.0981 9.5 17.5654 9.5 18.5V21.25Z"
                                fill="#1C274C"></path>
                        </g>
                    </svg>
                </div>
                <div>
                    <h4 class="text-2xl font-bold text-center">MikroMaju</h4>
                </div>
                <div class="border border-l-0 border-r-0 border-black border-dashed pt-1"></div>
                <div class="flex justify-between gap-12 py-4 border">
                    <div class="flex flex-col gap-2">
                        <span x-text="struk.date"></span>
                        <span class="flex">
                            No-
                            <span x-text="struk.id"></span>
                        </span>
                    </div>
                    <div class="flex flex-col gap-2">
                        <span x-text="struk.payment_method"></span>
                    </div>
                </div>
                <div class="border border-l-0 border-r-0 border-black border-dashed pt-1"></div>

                <div class="flex flex-col">
                    <template x-for="(detail, index) in struk.transaction_details" :key="detail.name + '' + index">
                        <div class="grid grid-cols-[4fr,0.9fr,2.3fr,2.8fr] gap-1 w-full justify-between text-end">
                            <span class="text-start pr-4" x-text="detail.name"></span>
                            <span class="flex gap-1">
                                x
                                <span x-text="detail.quantity"></span>
                            </span>
                            <span x-text="numberFormat(detail.price)"></span>
                            <span x-text="numberFormat(detail.sub_total)"></span>
                        </div>
                    </template>
                </div>
                <div class="border border-l-0 border-r-0 border-black border-dashed pt-1"></div>

                <div class="flex justify-between gap-12 py-4">
                    <span>Total</span>
                    <span class="font-bold" x-text="IDR.format(struk.total)"></span>
                </div>
                <div class="text-center">Thank you for using our service.</div>
                <div class="buttons mt-4 flex gap-4 print:hidden" x-show="!whilePrint">
                    <button class="border border-slate-400 rounded-md py-1 px-2 hover:text-slate-400 hover:border-black" @click="print">Print</button>
                    <button class="border border-slate-400 rounded-md py-1 px-2 hover:text-slate-400 hover:border-black" @click="isOpenStructModal = false">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
